<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=1024, initial-scale=1">

    <link rel="canonical" href="http://mosaico.io" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />

    <script src="rs/mosaico-libs-and-tinymce.min.js?v=__VERSION__"></script>
    <script src="rs/mosaico.min.js?v=__VERSION__"></script>
    <script>
$(function() {
  if (!Mosaico.isCompatible()) {
    alert('Update your browser!');
    return;
  }
  // var basePath = window.location.href.substr(0, window.location.href.lastIndexOf('/')).substr(window.location.href.indexOf('/','https://'.length));
  var basePath = window.location.href;
  if (basePath.lastIndexOf('#') > 0) basePath = basePath.substr(0, basePath.lastIndexOf('#'));
  if (basePath.lastIndexOf('?') > 0) basePath = basePath.substr(0, basePath.lastIndexOf('?'));
  if (basePath.lastIndexOf('/') > 0) basePath = basePath.substr(0, basePath.lastIndexOf('/'));

  var plugins;
  plugins = [
    function (viewModel) {
      console.log("Plugin hook");

      var saveCmd = {
        name: 'Zwischenspeichern',
        enabled: ko.observable(true)
      };

      saveCmd.execute = function () {
        saveCmd.enabled(false);

        // Here is the Mosaico data
        var html = viewModel.exportHTML();
        var json_data = viewModel.exportJSON();
        var meta = viewModel.exportMetadata();
        console.log(html);
        saveCmd.enabled(true);
        console.log("Executed save action");
      };

      viewModel.save = saveCmd;
    }
  ];

  Mosaico.start({
    imgProcessorBackend: basePath+'/img/',
    emailProcessorBackend: basePath+'/dl/',
    titleToken: "MOSAICO Responsive Email Designer",
    fileuploadConfig: {
      url: basePath+'/upload/',
      // messages??
    }
  }, "templates/versafix-1/template-versafix-1.html", undefined /* metadata */, undefined /* model */, plugins);
});
    </script>

    <link rel="stylesheet" href="rs/mosaico-libs-and-tinymce.min.css?v=__VERSION__" />
    <link rel="stylesheet" href="rs/mosaico-material.min.css?v=__VERSION__" />
  </head>
  <body class="mo-standalone">
    <!-- added this script to allow iframe resize-->
    <!-- lowest element tagged with "data-iframe-height" will be used to determine iframe height-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.0.4/iframeResizer.contentWindow.min.js"></script>
  </body>
</html>
